(function(b){function a(d,c){this.previewElement=d;this.options=c;this.animationLoaded=false}a.scopes=new Array();a.prototype={supportedFormats:["gif","jpeg","jpg","png"],activate:function(){var c=this;if(this.previewElement.width()===0){setTimeout(function(){c.activate()},100)}else{c.mode=c.getOption("mode");c.wrap();c.addSpinner();c.addControl();c.addEvents()}},wrap:function(){this.previewElement.addClass("gifplayer-ready");this.wrapper=this.previewElement.wrap("<div class='gifplayer-wrapper'></div>").parent();this.wrapper.css("width",this.previewElement.width());this.wrapper.css("height",this.previewElement.height());this.previewElement.css("cursor","pointer")},addSpinner:function(){this.spinnerElement=b("<div class = 'spinner'></div>");this.wrapper.append(this.spinnerElement);this.spinnerElement.hide()},getOption:function(c){var d=this.previewElement.data(c.toLowerCase());if(d!=undefined&&d!=""){return d}else{return this.options[c]}},addControl:function(){var c=this.getOption("label");this.playElement=b("<ins class='play-gif'>"+c+"</ins>");this.wrapper.append(this.playElement);this.playElement.css("top",this.previewElement.height()/2-this.playElement.height()/2);this.playElement.css("left",this.previewElement.width()/2-this.playElement.width()/2)},addEvents:function(){var c=this;var d=this.getOption("playOn");switch(d){case"click":c.playElement.on("click",function(f){c.previewElement.trigger("click")});c.previewElement.on("click",function(f){c.loadAnimation();f.preventDefault();f.stopPropagation()});break;case"hover":c.previewElement.on("click mouseover",function(f){c.loadAnimation();f.preventDefault();f.stopPropagation()});break;case"auto":console.log("auto not implemented yet");break;default:console.log(d+" is not accepted as playOn value.")}},processScope:function(){scope=this.getOption("scope");if(scope){if(a.scopes[scope]){a.scopes[scope].stopGif()}a.scopes[scope]=this}},loadAnimation:function(){this.processScope();this.spinnerElement.show();if(this.mode=="gif"){this.loadGif()}else{if(this.mode=="video"){if(!this.videoLoaded){this.loadVideo()}else{this.playVideo()}}}this.getOption("onPlay").call(this.previewElement)},stopGif:function(){this.gifElement.hide();this.previewElement.show();this.playElement.show();this.resetEvents();this.getOption("onStop").call(this.previewElement)},getFile:function(d){var c=this.getOption(d);if(c!=undefined&&c!=""){return c}else{replaceString=this.previewElement.attr("src");for(i=0;i<this.supportedFormats.length;i++){pattrn=new RegExp(this.supportedFormats[i]+"$","i");replaceString=replaceString.replace(pattrn,d)}return replaceString}},loadGif:function(){var e=this;e.playElement.hide();if(!this.animationLoaded){this.enableAbort()}var g=this.getFile("gif");var d=this.previewElement.width();var c=this.previewElement.height();this.gifElement=b("<img class='gp-gif-element' width='"+d+"' height=' "+c+" '/>");var f=this.getOption("wait");if(f){this.gifElement.load(function(){e.animationLoaded=true;e.resetEvents();e.previewElement.hide();e.wrapper.append(e.gifElement);e.spinnerElement.hide();e.getOption("onLoadComplete").call(e.previewElement)})}else{e.animationLoaded=true;e.resetEvents();e.previewElement.hide();e.wrapper.append(e.gifElement);e.spinnerElement.hide()}this.gifElement.css("cursor","pointer");this.gifElement.css("position","absolute");this.gifElement.css("top","0");this.gifElement.css("left","0");this.gifElement.attr("src",g);this.gifElement.click(function(h){b(this).remove();e.stopGif();h.preventDefault();h.stopPropagation()});e.getOption("onLoad").call(e.previewElement)},loadVideo:function(){this.videoLoaded=true;var f=this.getFile("mp4");var j=this.getFile("webm");var h=this.previewElement.width();var d=this.previewElement.height();this.videoElement=b('<video class="gp-video-element" width="'+h+'px" height="'+d+'" style="margin:0 auto;width:'+h+"px;height:"+d+'px;" autoplay="autoplay" loop="loop" muted="muted" poster="'+this.previewElement.attr("src")+'"><source type="video/mp4" src="'+f+'"><source type="video/webm" src="'+j+'"></video>');var e=this;var c=function(){if(e.videoElement[0].readyState===4){e.playVideo();e.animationLoaded=true}else{setTimeout(c,100)}};var g=this.getOption("wait");if(g){c()}else{this.playVideo()}this.videoElement.on("click",function(){if(e.videoPaused){e.resumeVideo()}else{e.pauseVideo()}})},playVideo:function(){this.spinnerElement.hide();this.previewElement.hide();this.playElement.hide();this.gifLoaded=true;this.previewElement.hide();this.wrapper.append(this.videoElement);this.videoPaused=false;this.videoElement[0].play();this.getOption("onPlay").call(this.previewElement)},pauseVideo:function(){this.videoPaused=true;this.videoElement[0].pause();this.playElement.show();this.mouseoverEnabled=false;this.getOption("onStop").call(this.previewElement)},resumeVideo:function(){this.videoPaused=false;this.videoElement[0].play();this.playElement.hide();this.getOption("onPlay").call(this.previewElement)},enableAbort:function(){var c=this;this.previewElement.click(function(d){c.abortLoading(d)});this.spinnerElement.click(function(d){c.abortLoading(d)})},abortLoading:function(c){this.spinnerElement.hide();this.playElement.show();c.preventDefault();c.stopPropagation();this.gifElement.off("load").on("load",function(d){d.preventDefault();d.stopPropagation()});this.resetEvents();this.getOption("onStop").call(this.previewElement)},resetEvents:function(){this.previewElement.off("click");this.previewElement.off("mouseover");this.playElement.off("click");this.spinnerElement.off("click");this.addEvents()}};b.fn.gifplayer=function(c){if(/^(play|stop)$/i.test(c)){return this.each(function(){c=c.toLowerCase();if(b(this).hasClass("gifplayer-ready")){var d=new a(b(this),null);d.options={};d.options=b.extend({},b.fn.gifplayer.defaults,d.options);d.wrapper=b(this).parent();d.spinnerElement=d.wrapper.find(".spinner");d.playElement=d.wrapper.find(".play-gif");d.gifElement=d.wrapper.find(".gp-gif-element");d.videoElement=d.wrapper.find(".gp-video-element");d.mode=d.getOption("mode");switch(c){case"play":d.playElement.trigger("click");break;case"stop":if(!d.playElement.is(":visible")){if(d.mode=="gif"){d.stopGif()}else{if(d.mode=="video"){d.videoElement.trigger("click")}}}break}}})}else{return this.each(function(){c=b.extend({},b.fn.gifplayer.defaults,c);var d=new a(b(this),c);d.activate()})}};b.fn.gifplayer.defaults={label:"GIF",playOn:"click",mode:"gif",gif:"",mp4:"",webm:"",wait:false,scope:false,onPlay:function(){},onStop:function(){},onLoad:function(){},onLoadComplete:function(){}}})(jQuery);